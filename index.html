<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focused Reading</title>
  <link rel="stylesheet" href="style.css">
  <script src="jszip.min.js"></script>
  <script type="importmap">
    {
      "imports": {
        "onnxruntime-web": "https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/esm/ort.min.js"
      }
    }
  </script>
</head>
<body>
  <div id="app">
    <!-- Library View -->
    <div id="library-view" class="view active">
      <header class="library-header">
        <h1>Focused Reading</h1>
        <p class="subtitle">Speed read your books, one word at a time</p>
      </header>
      <button id="help-btn" class="help-btn">? Help</button>
      <div class="library-actions">
        <label class="import-btn" for="epub-input">
          + Add Book
          <input type="file" id="epub-input" accept=".epub" hidden>
        </label>
      </div>

      <!-- Help Modal -->
      <div id="help-modal" class="help-modal hidden">
        <div class="help-modal-content">
          <button id="help-close" class="help-close">&times;</button>
          <h2>Getting Started</h2>
          <p>Import an EPUB file and click on a book to start speed reading. Words are displayed one at a time in the center of the screen.</p>

          <h3>Keyboard Shortcuts</h3>
          <table class="help-table">
            <tr><td><kbd>Space</kbd></td><td>Play / Pause</td></tr>
            <tr><td><kbd>&rarr;</kbd></td><td>Next sentence</td></tr>
            <tr><td><kbd>&larr;</kbd></td><td>Previous sentence</td></tr>
            <tr><td><kbd>&uarr;</kbd> / <kbd>&darr;</kbd></td><td>Speed up / slow down</td></tr>
            <tr><td><kbd>T</kbd></td><td>Toggle text panel</td></tr>
            <tr><td><kbd>V</kbd></td><td>Cycle voice mode</td></tr>
          </table>

          <h3>Voice Narration</h3>
          <p>Three voice modes are available:</p>
          <ul>
            <li><strong>Off</strong> &mdash; Silent, words displayed visually only</li>
            <li><strong>Browser</strong> &mdash; Uses your operating system's built-in voices via the Web Speech API. Zero latency, no downloads needed.</li>
            <li><strong>Piper</strong> &mdash; Neural TTS running in the browser via ONNX. Requires downloading a voice model (~63MB). Higher CPU usage with pauses between sentences.</li>
          </ul>

          <h3>Browser Voice Note</h3>
          <p>Browser TTS uses the Web Speech API, which only exposes basic system voices (Samantha, Daniel). macOS Enhanced and Siri voices are not available through this API in any browser.</p>
          <p>For higher quality narration, use <strong>Piper</strong> mode which runs a neural TTS model directly in the browser.</p>

          <h3>Text Panel</h3>
          <p>Press <kbd>T</kbd> or click the button at the top-right of the reader to open a side panel showing the full chapter text. The current word is highlighted and auto-scrolls as you read.</p>
        </div>
      </div>
      <div id="book-grid" class="book-grid">
        <p class="empty-state">No books yet. Import an EPUB to get started.</p>
      </div>
    </div>

    <!-- Reader View -->
    <div id="reader-view" class="view">
      <div class="reader-layout">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
          <button id="back-to-library" class="back-btn">&larr; Library</button>
          <div id="book-info" class="book-info"></div>
          <div class="chapter-list">
            <h3>Chapters</h3>
            <ul id="chapter-list"></ul>
          </div>
        </aside>

        <!-- Main Reader -->
        <main class="reader-main">
          <button id="toggle-sidebar" class="toggle-sidebar-btn" title="Toggle sidebar">&#9776;</button>
          <button id="toggle-textpanel" class="toggle-textpanel-btn" title="Toggle text panel (T)">&#9776;</button>
          <div class="reader-display">
            <div class="progress-bar-container">
              <div id="progress-bar" class="progress-bar"></div>
            </div>
            <div id="word-display" class="word-display">
              <span id="current-word">Press Play to start</span>
            </div>
            <div id="chapter-label" class="chapter-label"></div>
          </div>
          <div class="reader-controls">
            <div class="speed-control">
              <label for="wpm-slider">Speed: <span id="wpm-value">300</span> WPM</label>
              <input type="range" id="wpm-slider" min="100" max="1000" step="25" value="300">
            </div>
            <div class="playback-controls">
              <button id="prev-btn" class="control-btn" title="Previous sentence">&#9664;&#9664;</button>
              <button id="play-btn" class="control-btn play-btn" title="Play/Pause">&#9654;</button>
              <button id="next-btn" class="control-btn" title="Next sentence">&#9654;&#9654;</button>
            </div>
            <div class="voice-controls">
              <div class="voice-mode-selector">
                <button class="voice-mode-btn active" data-mode="off">Off</button>
                <button class="voice-mode-btn" data-mode="browser">Browser</button>
                <button class="voice-mode-btn" data-mode="piper">Piper</button>
              </div>
              <select id="voice-select" class="voice-dropdown hidden"></select>
              <div id="piper-controls" class="piper-controls hidden">
                <select id="piper-voice-select" class="voice-dropdown">
                  <option value="en_US-amy" data-label="Amy (US Female)">Amy (US Female)</option>
                  <option value="en_US-lessac" data-label="Lessac (US Female)">Lessac (US Female)</option>
                  <option value="en_US-ryan" data-label="Ryan (US Male)">Ryan (US Male)</option>
                  <option value="en_US-john" data-label="John (US Male)">John (US Male)</option>
                  <option value="en_GB-alba" data-label="Alba (UK Female)">Alba (UK Female)</option>
                  <option value="en_GB-alan" data-label="Alan (UK Male)">Alan (UK Male)</option>
                </select>
                <select id="piper-quality-select" class="voice-dropdown">
                  <option value="low">Low</option>
                  <option value="medium" selected>Medium</option>
                </select>
                <button id="piper-download-btn" class="piper-download-btn">Download Voice</button>
              </div>
              <div id="piper-status" class="piper-status hidden">
                <div class="piper-progress-bar"><div id="piper-progress-fill" class="piper-progress-fill"></div></div>
                <span id="piper-status-text"></span>
              </div>
            </div>
            <div class="position-control">
              <input type="range" id="position-slider" min="0" max="100" value="0" step="1">
            </div>
          </div>
        </main>

        <!-- Text Panel (right side) -->
        <aside id="text-panel" class="text-panel collapsed">
          <div id="text-panel-content" class="text-panel-content"></div>
        </aside>
      </div>
    </div>
  </div>
  <script src="app.js" type="module"></script>
</body>
</html>
